\documentclass[a4paper, 10pt]{article}

% urls
\usepackage[hyphens]{url}
\usepackage[unicode=true]{hyperref}
\hypersetup{
  bookmarks=true,
  bookmarksopen=true,
  breaklinks=true,
  citecolor=blue,
  colorlinks=true,
  pdfborder={0 0 0},
  pdfpagemode=UseOutlines,
  urlcolor=black,
}
\usepackage{relsize}
\renewcommand*{\UrlFont}{\ttfamily\smaller\relax}

%% layout
\usepackage[margin=2cm]{geometry}
\usepackage{fullpage}
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\setcounter{secnumdepth}{0}
\usepackage{float}

%% titles
\usepackage[compact]{titlesec}

% titleformat{command}[shape]{format}{label}{sep}{before-code}[after-code]
% titlespacing{command}{left}{before-sep}{after-sep}[right-sep]
% *n = n * (1ex plus .3ex minus .06ex} [ before ]
% *n = n * (1ex plus .1ex} [ after ]

\titleformat{\section}{\Large\bfseries}{}{0pt}{}
\titlespacing{\section}{0pt}{*2}{*1.5}

\titleformat{\subsection}{\large\bfseries}{}{0pt}{}
\titlespacing{\subsection}{0pt}{*2}{*0.75}

\titleformat{\subsubsection}{\bfseries}{}{0pt}{}
\titlespacing{\subsubsection}{0pt}{*2}{*0.5}

%% fonts
\usepackage{fontspec}
\setmainfont{Arial}
\setmonofont{Hack Nerd Font}

%% headers/footers
\usepackage{fancyhdr,lastpage}
\renewcommand{\headrulewidth}{0.2pt}
\setlength{\headheight}{3ex}
\pagestyle{fancy}
\lhead{Prof.~Richard Mortier: Publications}
\chead{}
\rhead{\today}
\lfoot{}
\cfoot{}
\rfoot{\thepage/\pageref{LastPage}}

\fancypagestyle{firststyle}
{
  \fancyhf{}
  \rfoot{\thepage/\pageref{LastPage}}
}

\usepackage[
backend=biber,
sorting=nymdt, % ddnt,
minnames=30,
maxnames=30,
defernumbers=true,
url=true,
doi=true,
eprint=true,
]{biblatex}

%% sort using date = yyyy-mm-dd or yyyy-mm or yyyy; ranges are yyyy-mm/yyyy-mm
\DeclareSortingTemplate{nymdt}{
  \sort{
    \field{presort}
  }
  \sort[final]{
    \field{sortkey}
  }
  \sort[direction=descending]{
    \field{sortyear}
    \field{year}
  }
  \sort[direction=descending]{
    \field[padside=left,padwidth=2,padchar=0]{month}
    \literal{00}
  }
  \sort[direction=descending]{
    \field[padside=left,padwidth=2,padchar=0]{day}
    \literal{00}
  }
  \sort{
    \field{sortname}
    \field{author}
    \field{editor}
    \field{translator}
    \field{sorttitle}
    \field{title}
  }
  \sort{
    \field{sorttitle}
  }
  \sort{
    \field[padside=left,padwidth=4,padchar=0]{volume}
    \literal{0000}
  }
}

%% SSRN support
\DeclareFieldFormat{eprint:ssrn}{
  SSRN: \ifhyperref{
      \href{https://ssrn.com/abstract=#1}{{#1}}
  }{
      \nolinkurl{https://ssrn.com/abstract=#1}}
}

%% magic to embolden my name;
%% https://tex.stackexchange.com/questions/33330/make-one-authors-name-bold-every-time-it-shows-up-in-the-bibliography

\usepackage{xstring,etoolbox}
\newboolean{bold}
\newcommand{\makeauthorsbold}[1]{%
  \DeclareNameFormat{author}{%
    \setboolean{bold}{false}%
    \renewcommand{\do}[1]{\expandafter\ifstrequal\expandafter{\namepartfamily}{####1}{\setboolean{bold}{true}}{}}%
      \docsvlist{#1}%
      \ifthenelse{\value{listcount}=1}
      {%
        {\expandafter\ifthenelse{\boolean{bold}}{\mkbibbold{\namepartfamily\addcomma\addspace \namepartgiveni}}{\namepartfamily\addcomma\addspace \namepartgiveni}}%
      }{\ifnumless{\value{listcount}}{\value{liststop}}
          {\expandafter\ifthenelse{\boolean{bold}}{\mkbibbold{\addcomma\addspace \namepartfamily\addcomma\addspace \namepartgiveni}}{\addcomma\addspace \namepartfamily\addcomma\addspace \namepartgiveni}}%
          {\expandafter\ifthenelse{\boolean{bold}}{\mkbibbold{\addcomma\addspace \namepartfamily\addcomma\addspace \namepartgiveni\addcomma\isdot}}{\addcomma\addspace \namepartfamily\addcomma\addspace \namepartgiveni\addcomma\isdot}}%
      }
      \ifthenelse{\value{listcount}<\value{liststop}}
        {\addcomma\space}{}
      }
}
\makeauthorsbold{Mortier}

%% Cambridge needs both page numbers and number of pages
\DeclareFieldFormat[article]{pagetotal}{(#1\,pages).}
\renewbibmacro*{note+pages}{%
  \printfield{note}%
  \setunit{\bibpagespunct}%
  \printfield{pages}%
  \setunit{ }%
  \printfield{pagetotal}%
  \newunit}
\DeclareFieldFormat[inproceedings]{pagetotal}{(#1\,pages).}
\renewbibmacro*{chapter+pages}{% % also used in @report
  \setunit{\bibpagespunct}%
  \printfield{pages}%
  \setunit{ }%
  \printfield{pagetotal}%
  \newunit}

\addbibresource{strings.bib}
\addbibresource{rmm-journal.bib}
\addbibresource{rmm-conference.bib}
\addbibresource{rmm-workshop.bib}
\addbibresource{rmm-patent.bib}
\addbibresource{rmm-techreport.bib}
\addbibresource{rmm-unpublished.bib}

\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map[overwrite]{
      \perdatasource{rmm-journal.bib}
      \step[fieldset=keywords, fieldvalue={, journal}, append]
    }
    \map[overwrite]{
      \perdatasource{rmm-conference.bib}
      \step[fieldset=keywords, fieldvalue={, conference}, append]
    }
    \map[overwrite]{
      \perdatasource{rmm-workshop.bib}
      \step[fieldset=keywords, fieldvalue={, workshop}, append]
    }
    \map[overwrite]{
      \perdatasource{rmm-patent.bib}
      \step[fieldset=keywords, fieldvalue={, patent}, append]
    }
    \map[overwrite]{
      \perdatasource{rmm-techreport.bib}
      \step[fieldset=keywords, fieldvalue={, techreport}, append]
    }
    % \map[overwrite]{
    %   \perdatasource{rmm-unpublished.bib}
    %   \step[fieldset=keywords, fieldvalue={, unpublished}, append]
    % }
  }
}

\defbibfilter{unreviewed}{%
  (  keyword=abstract
  or keyword=blog
  or keyword=chapter
  or keyword=book
  or keyword=magazine
  or keyword=poster
  ) and not keyword=unpublished
}

\defbibfilter{patent}{%
  keyword=patent
}

\defbibfilter{journal}{%
  keyword=journal
  and not (
  keyword=abstract
  or keyword=editorial
  or keyword=demo
  )
}

\defbibfilter{conference}{%
  keyword=conference
  and not (
  keyword=abstract
  or keyword=demo
  or keyword=editorial
  or keyword=invited
  or keyword=poster
  )
}

\defbibfilter{workshop}{%
  keyword=workshop
  and not (
  keyword=abstract
  or keyword=demo
  )
}

\defbibfilter{techreport}{%
  keyword=techreport
}

\begin{document}
\thispagestyle{firststyle}
\part*{\Large Prof.~Richard Mortier, Publications}


{
  \nocite{*}
  \newrefcontext
  \printbibliography[heading=subbibintoc, filter=journal, title={Peer-Reviewed Journal Papers}]
  \printbibliography[heading=subbibintoc, filter=conference, title={Peer-Reviewed Conference Papers}]
  \printbibliography[heading=subbibintoc, filter=workshop, title={Peer-Reviewed Workshop Papers}]
  \printbibliography[keyword=patent, filter=patent, title={Patents}]
  \printbibliography[keyword=techreport, filter=techreport, title={Technical Reports}]
  \printbibliography[heading=subbibintoc, filter=unreviewed, title={Editorials, Book Chapters, etc.}]
}

\end{document}
